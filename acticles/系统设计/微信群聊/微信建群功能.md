## 1. å¼•è¨€

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°â¤ã€‚

å½“æˆ‘é‚£å¤©æ‹¿ç€æ‰‹æœºï¼Œæ­£åœ¨å’Œæœ‹å‹ä»¬çš„å¾®ä¿¡ç¾¤é‡Œç•…èŠç€å…«å¦æ–°é—»å’Œå³å°†åˆ°æ¥çš„å‘¨æœ«è®¡åˆ’æ—¶ï¼Œå¿½ç„¶ä¸€ä¸ªç–‘é—®è¦ç»•å¿ƒå¤´ï¼šå¾®ä¿¡çš„è¿™ä¸ªç¾¤èŠç³»ç»Ÿæ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°èŠå¤©ã€åˆ†äº«å›¾ç‰‡å’Œè¡¨æƒ…ï¼Œè¿˜æœ‰é‚£ä¸ªç¥å¥‡çš„çº¢åŒ…åŠŸèƒ½ï¼Ÿ

è¿™ä¸ªé—®é¢˜ä¸€ç›´å›°æ‰°ç€ï¼Œäºæ˜¯æˆ‘å†³å®šæ·±å…¥äº†è§£ä¸€ä¸‹ï¼Œçœ‹çœ‹å¾®ä¿¡çš„ç¾¤èŠç³»ç»ŸèƒŒåçš„è®¾è®¡æ˜¯æ€æ ·çš„ã€‚



### å¾®ä¿¡ç¾¤èŠç³»ç»Ÿè®¾è®¡

å¾®ä¿¡ä½œä¸º 10 äº¿ç”¨æˆ·çº§åˆ«çš„å…¨æ°‘ Appï¼Œæƒ³å¿…å¤§å®¶éƒ½ç”¨è¿‡ï¼Œå¾®ä¿¡å»ºç¾¤åŠŸèƒ½æ˜¯å¾®ä¿¡é‡Œé¢æ ¸å¿ƒçš„ä¸€ä¸ªèƒ½åŠ›ï¼Œå®ƒå¯ä»¥å°†æ•°ç™¾ä¸ªå¥½å‹æˆ–é™Œç”Ÿäººæ”¾è¿›ä¸€ä¸ªç¾¤ç©ºé—´ã€‚

æˆ–è®¸ä½ å·²ç»åœ¨å¾®ä¿¡ä¸Šä½“éªŒè¿‡å¾ˆå¤šæ¬¡ç¾¤ç»„èŠå¤©ï¼Œä½†ä½ æ˜¯å¦å¥½å¥‡è¿‡è¿™ä¸ªèƒŒåçš„ç³»ç»Ÿæ˜¯å¦‚ä½•è®¾è®¡çš„å‘¢ï¼Ÿ

ä»Šå¤©æˆ‘ä»¬å°±æ¥æ¢è®¨ä¸€ä¸‹ã€‚



## 2. ç³»ç»Ÿéœ€æ±‚

### 2.1 ç³»ç»Ÿç‰¹ç‚¹ä¸åŠŸèƒ½éœ€æ±‚

å¾®ä¿¡ç¾¤èŠåŠŸèƒ½æ˜¯ç¤¾äº¤åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒå…è®¸ç”¨æˆ·åˆ›å»ºè‡ªå·±çš„ç¤¾äº¤åœˆå­ï¼Œä¸å®¶äººã€æœ‹å‹æˆ–å…±åŒå…´è¶£çˆ±å¥½è€…è¿›è¡Œå‹å¥½åœ°äº¤æµã€‚

ä»¥ä¸‹æ˜¯å¾®ä¿¡ç¾¤èŠç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼š

![image-20231017205423808](imgs/image-20231017205423808.png)

- **åˆ›å»ºç¾¤èŠ**ï¼šç”¨æˆ·å¯ä»¥åˆ›å»ºæ–°çš„èŠå¤©ç¾¤ç»„ï¼Œé‚€è¯·å…¶ä»–å¥½å‹ç”¨æˆ·åŠ å…¥æˆ–ä¸é™Œç”Ÿäººé¢å¯¹é¢å»ºç¾¤ã€‚
- **ç¾¤ç»„ç®¡ç†**ï¼šç¾¤ä¸»å’Œç®¡ç†å‘˜èƒ½å¤Ÿç®¡ç†ç¾¤æˆå‘˜ï¼Œè®¾ç½®è§„åˆ™å’Œæƒé™ã€‚
- **æ¶ˆæ¯å‘é€å’Œæ¥æ”¶**ï¼šå…è®¸ç¾¤æˆå‘˜å‘é€æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šç§ç±»å‹çš„æ¶ˆæ¯ï¼Œå¹¶æ¨é€ç»™æ‰€æœ‰ç¾¤æˆå‘˜ã€‚
- **å®æ—¶é€šä¿¡**ï¼šæ¶ˆæ¯åº”è¯¥èƒ½å¤Ÿå¿«é€Ÿä¼ é€’ï¼Œç¡®ä¿å®æ—¶äº’åŠ¨ã€‚
- **æŠ¢çº¢åŒ…**ï¼šç”¨æˆ·åœ¨ç¾¤èŠä¸­å‘é€ä»»æ„ä¸ªæ•°å’Œé‡‘é¢çš„çº¢åŒ…ï¼Œç¾¤æˆå‘˜å¯ä»¥æŠ¢åˆ°éšæœºé‡‘é¢çš„çº¢åŒ…ã€‚



### 2.2 éåŠŸèƒ½éœ€æ±‚ï¼šåº”å¯¹é«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€æµ·é‡å­˜å‚¨

å½“æˆ‘ä»¬é¢å¯¹ 10 äº¿å¾®ä¿¡ç”¨æˆ·æ¯å¤©éƒ½å¯èƒ½ä½¿ç”¨å»ºç¾¤åŠŸèƒ½çš„æƒ…æ™¯æ—¶ï¼Œå°±éœ€è¦å¤„ç†å¤§è§„æ¨¡çš„ç”¨æˆ·å¹¶å‘ã€‚è¿™å°±å¼•å‡ºäº†ç³»ç»Ÿçš„éåŠŸèƒ½éœ€æ±‚ï¼ŒåŒ…æ‹¬ï¼š

- **é«˜å¹¶å‘**ï¼šç³»ç»Ÿéœ€è¦æ”¯æŒå¤§é‡ç”¨æˆ·åŒæ—¶åˆ›å»ºå’Œä½¿ç”¨ç¾¤ç»„ï¼Œä»¥ç¡®ä¿æ— å»¶è¿Ÿçš„ç”¨æˆ·ä½“éªŒã€‚
- **é«˜æ€§èƒ½**ï¼šå¿«é€Ÿæ¶ˆæ¯ä¼ é€’ã€å³æ—¶å“åº”ï¼Œæ˜¯æ•°å­—ç¤¾äº¤çš„å…³é”®ã€‚
- **æµ·é‡å­˜å‚¨**ï¼šç³»ç»Ÿå¿…é¡»å¯æ‰©å±•ï¼Œä»¥å®¹çº³ç”¨æˆ·ç”Ÿæˆçš„æµ·é‡æ¶ˆæ¯æ–‡æœ¬ã€å›¾ç‰‡åŠéŸ³è§†é¢‘æ•°æ®ã€‚



## 3. æ¦‚è¦è®¾è®¡

åœ¨æ¦‚è¦è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘äº†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶å’ŒåŸºæœ¬ä¸šåŠ¡çš„æ¦‚è¦è®¾è®¡ã€‚

### 3.1 æ ¸å¿ƒç»„ä»¶

å¾®ä¿¡ç¾¤èŠç³»ç»Ÿä¸­ï¼Œä¼šæ¶‰åŠåˆ°å¦‚ä¸‹æ ¸å¿ƒç»„ä»¶æˆ–åè®®ã€‚

![image-20231020090525609](imgs/image-20231020090525609.png)

* **å®¢æˆ·ç«¯**ï¼šæ¥æ”¶æ‰‹æœºæˆ– PC ç«¯å¾®ä¿¡ç¾¤èŠçš„æ¶ˆæ¯ï¼Œå¹¶å®æ—¶ä¼ è¾“ç»™åå°æœåŠ¡å™¨
* **Websocketä¼ è¾“åè®®**ï¼šæ”¯æŒå®¢æˆ·ç«¯å’Œåå°æœåŠ¡ç«¯çš„å®æ—¶äº¤äº’ï¼Œå¼€é”€ä½ï¼Œå®æ—¶æ€§é«˜ï¼Œå¸¸ç”¨äºå¾®ä¿¡ã€QQ ç­‰ IM ç³»ç»Ÿé€šä¿¡ç³»ç»Ÿ
* **é•¿è¿æ¥é›†ç¾¤**ï¼šä¸å®¢æˆ·ç«¯è¿›è¡Œ Websocket é•¿è¿æ¥çš„ç³»ç»Ÿé›†ç¾¤ï¼Œå¹¶å°†æ¶ˆæ¯é€šè¿‡ä¸­é—´ä»¶è½¬å‘åˆ°åº”ç”¨æœåŠ¡å™¨
* **æ¶ˆæ¯å¤„ç†æœåŠ¡å™¨é›†ç¾¤**ï¼šæä¾›å®æ—¶æ¶ˆæ¯çš„å¤„ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€ä¸æ•°æ®åº“äº¤äº’ç­‰

- **æ¶ˆæ¯æ¨é€æœåŠ¡å™¨é›†ç¾¤**ï¼šè¿™æ˜¯ä¿¡æ¯çš„ä¸­è½¬ç«™ï¼Œè´Ÿè´£å°†æ¶ˆæ¯ä¼ é€’ç»™æ­£ç¡®çš„ç¾¤ç»„æˆå‘˜
- **æ•°æ®åº“æœåŠ¡å™¨é›†ç¾¤**ï¼šç”¨äºå­˜å‚¨ç”¨æˆ·æ–‡æœ¬æ•°æ®ã€å›¾ç‰‡çš„ç¼©ç•¥å›¾ã€éŸ³è§†é¢‘å…ƒæ•°æ®ç­‰
- **åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨é›†ç¾¤**ï¼šå­˜å‚¨ç”¨æˆ·å›¾ç‰‡ã€éŸ³è§†é¢‘ç­‰æ–‡ä»¶æ•°æ®



### 3.2 ä¸šåŠ¡æ¦‚è¦è®¾è®¡

#### ç¾¤èŠåˆ›å»º

- **å”¯ä¸€IDåˆ†é…**ï¼šå½“ç”¨æˆ·è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°ç¾¤ç»„æ—¶ï¼Œç³»ç»Ÿç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç¾¤ç»„ IDï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨å¦‚é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰æˆ–ç›´æ¥ä½¿ç”¨æ•°æ®åº“è‡ªå¢ IDã€‚è¿™é‡Œæˆ‘ä»¬ä¸ºäº†å®ç°ç®€ä¾¿ï¼Œé‡‡ç”¨ MySQL çš„è‡ªå¢ IDã€‚
- **ç¾¤ç»„ä¿¡æ¯å­˜å‚¨**ï¼šå°†ç¾¤ç»„ ID å’Œç›¸å…³ä¿¡æ¯ï¼ˆä¾‹å¦‚ç¾¤åã€åˆ›å»ºè€… ID ç­‰ï¼‰å­˜å‚¨åœ¨ç¾¤ç»„æ•°æ®åº“ä¸­ã€‚
- **æˆå‘˜å…³è”**ï¼šå°†ç¾¤ä¸»æ·»åŠ ä¸ºç¾¤ç»„çš„åˆ›å§‹æˆå‘˜ï¼ŒåŒæ—¶åˆ›å»ºè€…ä¹Ÿä¼šæˆä¸ºç®¡ç†å‘˜ã€‚
- **æ¶ˆæ¯å†å²è®°å½•**ï¼šä¸ºäº†ç¡®ä¿æ–°æˆå‘˜èƒ½å¤Ÿè®¿é—®ä»¥å‰çš„æ¶ˆæ¯ï¼Œå°†æ­¤æ–°ç¾¤ç»„çš„ç¾¤ç»„ ID ä¸ç”¨æˆ·æ¶ˆæ¯å…³è”å­˜å‚¨ã€‚

é™¤äº†æ‹‰å¥½å‹å»ºç¾¤ï¼Œå¾®ä¿¡è¿˜å®ç°äº†é¢å¯¹é¢å»ºç¾¤çš„èƒ½åŠ›ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†ä¸‰åˆ°å››ä¸ªæ ¸å¿ƒåŠŸèƒ½çš„è¯¦ç»†è®¾è®¡ï¼ŒåŒ…æ‹¬é¢å¯¹é¢å»ºç¾¤ã€æ¶ˆæ¯å‘é€ä¸æ¥æ”¶åŠæŠ¢çº¢åŒ…åŠŸèƒ½ã€‚



## 4. é¢å¯¹é¢å»ºç¾¤

ç”¨æˆ·å‘èµ·é¢å¯¹é¢å»ºç¾¤ï¼Œå¹¶è¾“å…¥ä¸€ä¸ª 4 ä½æ•°çš„éšæœºç ï¼Œå‘¨å›´çš„ç”¨æˆ·è¾“å…¥è¯¥éšæœºç åå¯åŠ å…¥ç¾¤èŠï¼Œé¢å¯¹é¢å»ºç¾¤åŠŸèƒ½é€šå¸¸æ¶‰åŠæ•°æ®è¡¨è®¾è®¡å’Œæ ¸å¿ƒä¸šåŠ¡äº¤äº’æµç¨‹å¦‚ä¸‹ã€‚

### 4.1 æ•°æ®åº“è¡¨è®¾è®¡

1. **User è¡¨**ï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·IDã€æ˜µç§°ã€å¤´åƒç­‰ã€‚
2. **Group è¡¨**ï¼šå­˜å‚¨ç¾¤ç»„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¾¤IDã€ç¾¤åç§°ã€åˆ›å»ºè€…IDç­‰ã€‚
3. **GroupMember è¡¨**ï¼šå…³è”ç”¨æˆ·å’Œç¾¤ç»„ï¼ŒåŒ…æ‹¬ç”¨æˆ·IDå’Œç¾¤IDã€‚
4. **RandomCode è¡¨**ï¼šå­˜å‚¨é¢å¯¹é¢å»ºç¾¤çš„éšæœºç å’Œå…³è”çš„ç¾¤IDã€‚



### 4.2 æ ¸å¿ƒä¸šåŠ¡äº¤äº’æµç¨‹

![image-20231020093539062](imgs/image-20231020093539062.png)

ç”¨æˆ· A åœ¨æ‰‹æœºç«¯åº”ç”¨ä¸­å‘èµ·é¢å¯¹é¢å»ºç¾¤ï¼Œå¹¶è¾“å…¥ä¸€ä¸ªéšæœºç ï¼Œæ ¡éªŒé€šè¿‡åï¼Œç­‰å¾…å‘¨å›´ï¼ˆ50 ç±³ä¹‹å†…ï¼‰çš„ç”¨æˆ·åŠ å…¥ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿå°†ç”¨æˆ·ä¿¡æ¯ä»¥ `HashMap` çš„æ–¹å¼å­˜å…¥ç¼“å­˜ä¸­ã€‚

``` json
{éšæœºç ï¼Œç”¨æˆ·åˆ—è¡¨[ç”¨æˆ·A(IDã€åç§°ã€å¤´åƒ)]}
```

ç”¨æˆ· B åœ¨å¦ä¸€ä¸ªæ‰‹æœºç«¯å‘èµ·é¢å¯¹é¢å»ºç¾¤ï¼Œè¾“å…¥æŒ‡å®šçš„éšæœºç ï¼Œ**å¦‚æœè¯¥ç”¨æˆ·å‘¨å›´æœ‰è¿™æ ·çš„éšæœºç ï¼Œåˆ™è¿›å…¥åŒä¸€ä¸ªç¾¤èŠç­‰å¾…é¡µé¢ï¼Œå¹¶å¯ä»¥çœ‹åˆ°å…¶å®ƒç¾¤å‘˜çš„å¤´åƒå’Œæ˜µç§°ä¿¡æ¯**ã€‚

æ­¤æ—¶ï¼Œç³»ç»Ÿé™¤äº†æ ¹æ®éšæœºç è·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œä¹Ÿä¼šå®æ—¶æ›´æ–°ç¼“å­˜é‡Œçš„ç”¨æˆ·ä¿¡æ¯ã€‚

![image-20231026223956822](imgs/image-20231026223956822.png)

å½“ç¬¬ä¸€ä¸ªç”¨æˆ·ç‚¹å‡»**è¿›å…¥è¯¥ç¾¤**æ—¶ï¼Œå°±å¯ä»¥åŠ å…¥ç¾¤èŠï¼Œç³»ç»Ÿå°†ç”Ÿæˆçš„éšæœºç ä¿å­˜åœ¨ `RandomCode` è¡¨ä¸­ï¼Œå¹¶å…³è”åˆ°æ–°åˆ›å»ºçš„ç¾¤ IDã€‚

ç„¶åï¼Œç³»ç»Ÿå°†ç”¨æˆ·ä¿¡æ¯å’Œæ–°ç”Ÿæˆçš„ç¾¤èŠä¿¡æ¯å­˜å‚¨åœ¨ `Groupã€GroupMember` è¡¨ä¸­



#### æˆå‘˜åŠ å…¥ï¼Œåˆ·æ–°ç¾¤å‘˜ä¿¡æ¯

ä¹‹å Bã€C ç”¨æˆ·å¸¦ç€éšæœºç åŠ å…¥ç¾¤èŠæ—¶ï¼Œæ‰‹æœºå®¢æˆ·ç«¯å‘æœåŠ¡å™¨åç«¯å‘é€è¯·æ±‚ï¼ŒéªŒè¯éšæœºç æ˜¯å¦æœ‰æ•ˆã€‚æœåŠ¡å™¨åç«¯éªŒè¯éšæœºç ï¼Œæ£€æŸ¥éšæœºç æ˜¯å¦å­˜åœ¨äº `RandomCode` è¡¨ä¸­ï¼Œä»¥åŠæ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ã€‚

å¦‚æœéªŒè¯é€šè¿‡ï¼ŒæœåŠ¡å™¨åç«¯å°†ç”¨æˆ· Bã€C æ·»åŠ åˆ°ç¾¤æˆå‘˜è¡¨ `GroupMember` ä¸­ï¼Œå¹¶è¿”å›æˆåŠŸå“åº”ã€‚

ç§»åŠ¨å®¢æˆ·ç«¯åº”ç”¨æ”¶åˆ°æˆåŠŸå“åº”åï¼Œæ›´æ–°ç”¨æˆ· Bã€C çš„ç¾¤èŠåˆ—è¡¨ï¼Œå±•ç¤ºä»–ä»¬å·²åŠ å…¥çš„æ–°ç¾¤èŠã€‚



#### å…¶å®ƒæŠ€æœ¯ç»„ä»¶

è¿™æ ·ï¼Œç”¨æˆ· A é€šè¿‡åˆ›å»ºéšæœºç å’Œå‘¨å›´çš„ç”¨æˆ·æ‰«æäºŒç»´ç çš„æ–¹å¼æˆåŠŸå»ºç«‹äº†ä¸€ä¸ªé¢å¯¹é¢å»ºç¾¤ã€‚è¿™ä¸ªåŠŸèƒ½æ¶‰åŠäº†å¤šä¸ªæŠ€æœ¯ç»„ä»¶ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨åç«¯ã€æ•°æ®åº“ã€äºŒç»´ç ç”Ÿæˆå’ŒéªŒè¯ç­‰ã€‚

åŒæ—¶ï¼Œåœ¨é¢å¯¹é¢å»ºç¾¤çš„è¿‡ç¨‹ä¸­ç›¸å½“é‡è¦çš„èƒ½åŠ›æ˜¯æ ‡è¯†ç”¨æˆ·çš„åŒºåŸŸï¼Œæ¯”å¦‚ 50 ç±³ä»¥å†…ã€‚è¿™ä¸ªå¯ä»¥ç”¨åˆ° Redis çš„ GeoHash ç®—æ³•ï¼Œæ¥è·å–ä¸€ä¸ªèŒƒå›´å†…çš„æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚

ç”±äºç¯‡å¹…æœ‰é™ï¼Œä¸å†èµ˜è¿°è¯¥ç®—æ³•ã€‚æƒ³äº†è§£æ›´å¤šå’Œç®—æ³•ç›¸å…³çš„ç»†èŠ‚ï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼šå¬è¯´ä½ ä¼šæ¶æ„è®¾è®¡ï¼Ÿæ¥ï¼Œå¼„ä¸€ä¸ªå…¬äº¤&åœ°é“ä¹˜è½¦ç³»ç»Ÿã€‚



## 5. æ¶ˆæ¯å‘é€ä¸æ¥æ”¶

å½“æŸä¸ªæˆå‘˜åœ¨å¾®ä¿¡ç¾¤é‡Œå‘è¨€ï¼Œç³»ç»Ÿéœ€è¦å¤„ç†æ¶ˆæ¯çš„åˆ†å‘ã€é€šçŸ¥å…¶ä»–æˆå‘˜ã€ä»¥åŠç¡®ä¿æ¶ˆæ¯çš„æ˜¾ç¤ºã€‚ä»¥ä¸‹æ˜¯è¿™ä¸€åŠŸèƒ½çš„è¯¦ç»†äº¤äº’æ­¥éª¤ï¼Œç›¸å…³æŠ€æœ¯ç»„ä»¶å’Œæ•°æ®åº“è¡¨å­˜å‚¨æ–¹æ¡ˆã€‚



### 5.1 äº¤äº’æµç¨‹

æ¶ˆæ¯å‘é€å’Œæ¥æ”¶æ—¶åºå›¾å¦‚ä¸‹ï¼š

![image-20231026094116788](imgs/image-20231026094116788.png)

1. ç”¨æˆ·Aåœ¨ç¾¤ä¸­å‘é€ä¸€æ¡å¸¦æœ‰å›¾ç‰‡ã€è§†é¢‘æˆ–éŸ³é¢‘çš„æ¶ˆæ¯ã€‚
2. ç§»åŠ¨å®¢æˆ·ç«¯åº”ç”¨å°†æ¶ˆæ¯å†…å®¹å’Œåª’ä½“æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨åç«¯ã€‚
3. æœåŠ¡å™¨åç«¯æ¥æ”¶åˆ°æ¶ˆæ¯å’Œåª’ä½“æ–‡ä»¶åï¼Œå°†æ¶ˆæ¯å†…å®¹å­˜å‚¨åˆ° Message è¡¨ä¸­ï¼ŒåŒæ—¶å°†åª’ä½“æ–‡ä»¶å­˜å‚¨åˆ°åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨é›†ç¾¤ä¸­ã€‚**åœ¨ Message è¡¨é‡Œï¼Œä¸ä»…è®°å½•äº†åª’ä½“æ–‡ä»¶çš„ MediaIDï¼Œä»¥ä¾¿å…³è”æ¶ˆæ¯å’Œåª’ä½“ï¼›è¿˜è®°å½•äº†ç¼©ç•¥å›¾ã€è§†é¢‘å°é¢å›¾ç­‰ç­‰**ã€‚
4. æœåŠ¡å™¨åç«¯ä¼šå‘æ‰€æœ‰ç¾¤æˆå‘˜å¹¿æ’­è¿™æ¡æ¶ˆæ¯ã€‚ç§»åŠ¨å®¢æˆ·ç«¯åº”ç”¨æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šæ ¹æ®æ¶ˆæ¯ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ï¼‰åŠ è½½å¯¹åº”çš„å±•ç¤ºæ–¹å¼ã€‚
5. å½“ç”¨æˆ·ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡ã€è§†é¢‘æˆ–éŸ³é¢‘ç¼©ç•¥å›¾æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ä¼šæ ¹æ® `MediaID` åˆ°å¯¹è±¡å­˜å‚¨é›†ç¾¤ä¸­è·å–å¯¹åº”çš„åª’ä½“æ–‡ä»¶è·¯å¾„ï¼Œå¹¶å°†å…¶å±•ç¤ºç»™ç”¨æˆ·ã€‚

è¿™ä¸ªæµç¨‹ç¡®ä¿äº†æ¶ˆæ¯å’Œåª’ä½“æ–‡ä»¶çš„æœ‰æ•ˆå­˜å‚¨å’Œå±•ç¤ºã€‚ç”¨æˆ·å¯ä»¥ä¸Šä¼ å’ŒæŸ¥çœ‹å„ç§ç±»å‹çš„åª’ä½“æ•°æ®ï¼Œè€ŒæœåŠ¡å™¨åç«¯é€šè¿‡å…³è” `Message` å’Œå¯¹è±¡å­˜å‚¨æœåŠ¡å™¨ä¸­çš„ä¿¡æ¯ï¼Œå®ç°äº†æœ‰æ•ˆçš„æ¶ˆæ¯å­˜å‚¨å’Œå±•ç¤ºã€‚



### 5.2 æ¶ˆæ¯å­˜å‚¨å’Œå±•ç¤º

åœ¨å¾®ä¿¡ç¾¤ä¸­ä¿å­˜å’Œå±•ç¤ºç”¨æˆ·çš„å›¾ç‰‡ã€è§†é¢‘æˆ–éŸ³é¢‘æ•°æ®ï¼Œé€šå¸¸éœ€è¦è¿›è¡Œæ•°æ®å­˜å‚¨å’Œå±•ç¤ºæ–¹é¢çš„è®¾è®¡ã€‚é™¤äº†ä¸Šé¢æåˆ°çš„ç”¨æˆ·è¡¨å’Œç¾¤ç»„è¡¨ä»¥å¤–ï¼Œè¿˜éœ€è¦ä»¥ä¸‹è¡¨ç»“æ„ï¼š

1. **Messageè¡¨ï¼š** ç”¨äºå­˜å‚¨æ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ MessageIDï¼Œæ¶ˆæ¯ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ï¼‰ï¼Œæ¶ˆæ¯å†…å®¹ï¼ˆæ–‡å­—ã€å›¾ç‰‡ç¼©ç•¥å›¾ã€è§†é¢‘å°é¢å›¾ç­‰ï¼‰ï¼Œå‘é€è€… UserIDã€æ¥æ”¶ç¾¤ GroupIDã€å‘é€æ—¶é—´ç­‰å­—æ®µã€‚
4. **Mediaè¡¨ï¼š** å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰åª’ä½“æ•°æ®ã€‚æ¯ä¸ªåª’ä½“æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ MediaIDï¼Œæ–‡ä»¶è·¯å¾„ã€ä¸Šä¼ è€… UserIDã€ä¸Šä¼ æ—¶é—´ç­‰å­—æ®µã€‚
3. **MessageStateè¡¨ï¼š** ç”¨äºå­˜å‚¨ç”¨æˆ·æ¶ˆæ¯çŠ¶æ€ï¼ŒåŒ…æ‹¬ MessageIDã€ç”¨æˆ· IDã€æ˜¯å¦å·²è¯»ç­‰ã€‚åœ¨æ¶ˆæ¯æ¨é€æ—¶ï¼Œé€šè¿‡è¿™å¼ è¡¨è®¡ç®—æœªè¯»æ•°ï¼Œç»Ÿä¸€æ¨é€ç»™ç”¨æˆ·ï¼Œå¹¶åœ¨ç¦»çº¿ç”¨æˆ·çš„æ‰‹æœºä¸Šå±•ç¤ºä¸€ä¸ªå°æ•°å­—ä»£è¡¨æ¶ˆæ¯æœªè¯»æ•°ã€‚

ä¸ºäº†æœåŠ¡çš„æŸ¥è¯¢æ€§èƒ½è€ƒè™‘ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å°†ç”¨æˆ·çš„å·²è¯»çŠ¶æ€å­˜å…¥ Redisï¼Œå¹¶å®æ—¶è®°å½•ä¸€ä¸ªæœªè¯»æ•°å€¼ã€‚å¹¶ä¸”ï¼Œå½“æœªè¯»æ•°å¤§äº 99 æ—¶ï¼Œå°±å°†æœªè¯»æ•°å€¼ç½®ä¸º 100 ä¸”ä¸å†å¢åŠ ã€‚

å½“æ¨é€ç”¨æˆ·æ¶ˆæ¯æ—¶ï¼Œ**åªè¦æœªè¯»æ•°ä¸º 100ï¼Œå°±å°†æ¨é€æ¶ˆæ¯æ•°è®¾ç½®ä¸º `99+`ï¼Œä»¥æ­¤æ¥æå‡å­˜å‚¨çš„æ€§èƒ½å’Œäº¤äº’çš„æ•ˆç‡ã€‚**



## 6. æŠ¢çº¢åŒ…

æŠ¢çº¢åŒ…åŠŸèƒ½å…è®¸ç”¨æˆ·åœ¨ç¾¤èŠä¸­å‘é€ä»»æ„ä¸ªæ•°å’Œé‡‘é¢çš„çº¢åŒ…ï¼Œç¾¤æˆå‘˜å¯ä»¥æŠ¢åˆ°éšæœºé‡‘é¢çš„çº¢åŒ…ï¼Œä½†è¦**ä¿è¯æ¯ä¸ªç”¨æˆ·çš„çº¢åŒ…é‡‘é¢ä¸å°äº 0.01 å…ƒ**ã€‚

æŠ¢çº¢åŒ…çš„è¯¦ç»†äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š

1. ç”¨æˆ·æ¥æ”¶åˆ°æŠ¢çº¢åŒ…é€šçŸ¥ï¼Œç‚¹å‡»é€šçŸ¥æ‰“å¼€ç¾¤èŠé¡µé¢
2. ç”¨æˆ·ç‚¹å‡»æŠ¢çº¢åŒ…ï¼Œåå°æœåŠ¡éªŒè¯ç”¨æˆ·èµ„æ ¼ï¼Œç¡®ä¿ç”¨æˆ·å°šæœªé¢†å–è¿‡æ­¤çº¢åŒ…
4. è‹¥ç”¨æˆ·èµ„æ ¼éªŒè¯é€šè¿‡ï¼Œåå°æœåŠ¡åˆ†é…çº¢åŒ…é‡‘é¢å¹¶å­˜å‚¨é¢†å–è®°å½•
5. ç”¨æˆ·åœ¨å¾®ä¿¡ç¾¤ä¸­çœ‹åˆ°é¢†å–é‡‘é¢ï¼Œçº¢åŒ…çŠ¶æ€æ›´æ–°ä¸ºâ€œå·²é¢†å–â€
5. å¼‚æ­¥è°ƒç”¨æ”¯ä»˜æ¥å£ï¼Œå°†çº¢åŒ…é‡‘é¢æ›´æ–°åˆ°é’±åŒ…é‡Œ

éœ€è¦å…³æ³¨æŠ¢çº¢åŒ…çš„æ•°æ®åº“è®¾è®¡ï¼ŒæŠ¢çº¢åŒ…å®æ—¶æ€§å’Œçº¢åŒ…åˆ†é…ç®—æ³•ã€‚



### 6.1 æ•°æ®åº“è®¾è®¡

çº¢åŒ…è¡¨ `redpack` çš„å­—æ®µå¦‚ä¸‹ï¼š

* **idï¼š** ä¸»é”®ï¼Œçº¢åŒ…ID
* **totalAmountï¼š** æ€»é‡‘é¢
* **surplusAmountï¼š** å‰©ä½™é‡‘é¢
* **totalï¼š** çº¢åŒ…æ€»æ•°
* **surplusTotalï¼š** å‰©ä½™çº¢åŒ…æ€»æ•°
* **userIdï¼š** å‘çº¢åŒ…çš„ç”¨æˆ·ID

è¯¥è¡¨ç”¨æ¥è®°å½•ç”¨æˆ·å‘äº†å¤šå°‘çº¢åŒ…ï¼Œä»¥åŠéœ€è¦ç»´æŠ¤çš„å‰©ä½™é‡‘é¢ã€‚



çº¢åŒ…è®°å½•è¡¨ `redpack_record` å¦‚ä¸‹ï¼š

* **idï¼š** ä¸»é”®ï¼Œè®°å½•ID
* **redpackIdï¼š** çº¢åŒ…IDï¼Œå¤–é”®
* **userIdï¼š** ç”¨æˆ·ID
* **amountï¼š** æŠ¢åˆ°çš„é‡‘é¢

è®°å½•è¡¨ç”¨æ¥å­˜æ”¾ç”¨æˆ·å…·ä½“æŠ¢åˆ°çš„çº¢åŒ…ä¿¡æ¯ï¼Œä¹Ÿæ˜¯çº¢åŒ…è¡¨çš„å‰¯è¡¨ã€‚



### 6.2 å®æ—¶æ€§

#### 1ã€å‘çº¢åŒ…

1. ç”¨æˆ·è®¾ç½®çº¢åŒ…çš„æ€»é‡‘é¢å’Œä¸ªæ•°åï¼Œåœ¨çº¢åŒ…è¡¨ä¸­å¢åŠ ä¸€æ¡æ•°æ®ï¼Œå¼€å§‹å‘çº¢åŒ…
2. ä¸ºäº†ä¿è¯å®æ—¶æ€§å’ŒæŠ¢çº¢åŒ…çš„æ•ˆç‡ï¼Œåœ¨ Redis ä¸­å¢åŠ ä¸€æ¡è®°å½•ï¼Œå­˜å‚¨çº¢åŒ… ID å’Œæ€»äººæ•° n
3. æŠ¢çº¢åŒ…æ¶ˆæ¯æ¨é€ç»™æ‰€æœ‰ç¾¤æˆå‘˜



#### 2ã€æŠ¢çº¢åŒ…

ä» 2015 å¹´åï¼Œå¾®ä¿¡çº¢åŒ…çš„æŠ¢çº¢åŒ…å’Œæ‹†çº¢åŒ…å°±åˆ†ç¦»äº†ï¼Œç”¨æˆ·ç‚¹å‡»æŠ¢çº¢åŒ…åéœ€è¦è¿›è¡Œä¸¤æ¬¡æ“ä½œã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ˜æ˜æœ‰æ—¶å€™æŠ¢åˆ°äº†çº¢åŒ…ï¼Œç‚¹å¼€åå´å‘ç°**è¯¥çº¢åŒ…å·²ç»è¢«é¢†å–å®Œäº†**ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ã€‚

1. æŠ¢çº¢åŒ…ï¼šæŠ¢æ“ä½œåœ¨ `Redis` ç¼“å­˜å±‚å®Œæˆï¼Œ**é€šè¿‡åŸå­é€’å‡çš„æ“ä½œæ¥æ›´æ–°çº¢åŒ…ä¸ªæ•°**ï¼Œåˆ° 0 åå°±è¯´æ˜æŠ¢å…‰äº†ã€‚
2. æ‹†çº¢åŒ…ï¼šæ‹†çº¢åŒ…æ—¶ï¼Œé¦–å…ˆä¼šå®æ—¶è®¡ç®—é‡‘é¢ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡**äºŒå€å‡å€¼æ³•**å®ç°ï¼ˆå³ 0.01 åˆ°å‰©ä½™å¹³å‡å€¼çš„ 2 å€ä¹‹é—´ï¼‰ã€‚
3. çº¢åŒ…è®°å½•ï¼šç”¨æˆ·è·å–çº¢åŒ…é‡‘é¢åï¼Œé€šè¿‡æ•°æ®åº“çš„äº‹åŠ¡æ“ä½œç´¯åŠ å·²ç»é¢†å–çš„ä¸ªæ•°å’Œé‡‘é¢ï¼Œå¹¶æ›´æ–°çº¢åŒ…è¡¨å’Œè®°å½•è¡¨ã€‚
4. è½¬è´¦ï¼šä¸ºäº†æå‡æ•ˆç‡ï¼Œæœ€ç»ˆçš„**è½¬è´¦ä¸ºå¼‚æ­¥æ“ä½œ**ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨æ˜¥èŠ‚æœŸé—´ï¼Œçº¢åŒ…é¢†å–åä¸èƒ½ç«‹å³åœ¨ä½™é¢ä¸­çœ‹åˆ°çš„åŸå› ã€‚



### 6.3 çº¢åŒ…åˆ†é…ç®—æ³•

çº¢åŒ…é‡‘é¢åˆ†é…æ—¶ï¼Œç”±äºæ˜¯éšæœºåˆ†é…ï¼Œæ‰€ä»¥æœ‰ä¸¤ç§å®ç°æ–¹æ¡ˆï¼šå®æ—¶æ‹†åˆ†å’Œé¢„å…ˆç”Ÿæˆã€‚

#### 1ã€å®æ—¶æ‹†åˆ†

å®æ—¶æ‹†åˆ†ï¼ŒæŒ‡çš„æ˜¯åœ¨**æŠ¢çº¢åŒ…æ—¶å®æ—¶è®¡ç®—**æ¯ä¸ªçº¢åŒ…çš„é‡‘é¢ï¼Œä»¥å®ç°çº¢åŒ…çš„æ‹†åˆ†è¿‡ç¨‹ã€‚

è¿™ä¸ªå¯¹ç³»ç»Ÿæ€§èƒ½å’Œæ‹†åˆ†ç®—æ³•è¦æ±‚è¾ƒé«˜ï¼Œä¾‹å¦‚æ‹†åˆ†è¿‡ç¨‹è¦ä¸€ç›´ä¿è¯åç»­å¾…æ‹†åˆ†çº¢åŒ…çš„é‡‘é¢ä¸èƒ½ä¸ºç©ºï¼Œä¸å®¹æ˜“åšåˆ°æ‹†åˆ†çš„çº¢åŒ…é‡‘é¢æœä»**æ­£æ€åˆ†å¸ƒ**è§„å¾‹ã€‚



#### 2ã€é¢„å…ˆç”Ÿæˆ

é¢„å…ˆç”Ÿæˆï¼ŒæŒ‡çš„æ˜¯åœ¨çº¢åŒ…**å¼€æŠ¢ä¹‹å‰**å·²ç»å®Œæˆäº†çº¢åŒ…çš„**é‡‘é¢æ‹†åˆ†**ï¼ŒæŠ¢çº¢åŒ…æ—¶åªæ˜¯ä¾æ¬¡å–å‡ºæ‹†åˆ†å¥½çš„çº¢åŒ…é‡‘é¢ã€‚

è¿™ç§æ–¹å¼å¯¹æ‹†åˆ†ç®—æ³•è¦æ±‚è¾ƒä½ï¼Œå¯ä»¥æ‹†åˆ†å‡ºéšæœºæ€§å¾ˆå¥½çš„çº¢åŒ…é‡‘é¢ï¼Œä½†é€šå¸¸éœ€è¦ç»“åˆé˜Ÿåˆ—ä½¿ç”¨ã€‚



#### 3ã€äºŒå€å‡å€¼æ³•

ç»¼åˆä¸Šè¿°ä¼˜ç¼ºç‚¹è€ƒè™‘ï¼Œä»¥åŠå¾®ä¿¡ç¾¤èŠä¸­çš„äººæ•°ä¸å¤šï¼ˆç›®å‰æœ€é«˜ 500 äººï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨å®æ—¶æ‹†åˆ†çš„æ–¹å¼ï¼Œé‡‡ç”¨**äºŒå€å‡å€¼æ³•**æ¥ç”Ÿæˆéšæœºçº¢åŒ…ï¼Œåªæ»¡è¶³éšæœºå³å¯ï¼Œä¸éœ€è¦æ­£æ€åˆ†å¸ƒã€‚

> æ•…å¯èƒ½å‡ºç°å¾ˆå¤§çš„çº¢åŒ…å·®é¢ï¼Œä½†è¿™æ›´åˆºæ¿€ä¸æ˜¯å—:dog:

ä½¿ç”¨äºŒå€å‡å€¼æ³•ç”Ÿæˆçš„éšæœºæ•°ï¼Œæ¯æ¬¡éšæœºé‡‘é¢ä¼šåœ¨ `0.01 ~ å‰©ä½™å¹³å‡å€¼*2` ä¹‹é—´ã€‚

å‡è®¾å½“å‰çº¢åŒ…å‰©ä½™é‡‘é¢ä¸º 10 å…ƒï¼Œå‰©ä½™ä¸ªæ•°ä¸º 5ã€‚`10/5 = 2`ï¼Œåˆ™å½“å‰ç”¨æˆ·å¯ä»¥æŠ¢åˆ°çš„çº¢åŒ…é‡‘é¢ä¸ºï¼š`0.01 ~ 4` å…ƒä¹‹é—´ã€‚



#### 4ã€ç®—æ³•ä¼˜åŒ–

ç”¨äºŒå€å‡å€¼æ³•ç”Ÿæˆçš„éšæœºçº¢åŒ…è™½ç„¶æ¥è¿‘å¹³å‡å€¼ï¼Œä½†ä¹‹å‰æˆ‘åœ¨æŸè®ºå›ä¸Šçœ‹åˆ°è¿‡ç±»ä¼¼çš„è¯´æ³•ï¼šå¾®ä¿¡çº¢åŒ…é‡‘é¢çš„éšæœºæ€§å’Œé¢†å–çš„æ—¶æœºæœ‰å…³ç³»ï¼Œå°¤å…¶æ˜¯é‡‘é¢ä¸é«˜çš„æƒ…å†µä¸‹ã€‚

äºæ˜¯ï¼Œæˆ‘è€—è´¹å·¨èµ„åœ¨å¾®ä¿¡ç¾¤å‘äº†å¤šä¸ªçº¢åŒ…ï¼Œå¾—å‡ºäº†è¿™æ ·ä¸€ä¸ªç»“è®ºï¼šå¦‚æœå‘å‡ºçš„ `çº¢åŒ…æ€»é¢ = çº¢åŒ…æ•°*0.01 + 0.01`ï¼Œæ¯”å¦‚ï¼šå‘äº† 4 ä¸ªçº¢åŒ…ï¼Œæ€»é¢ä¸º 0.05ï¼Œåˆ™æœ€åä¸€ä¸ªäººé¢†å–çš„çº¢åŒ…é‡‘é¢ä¸€å®šæ˜¯ `0.02`ã€‚

![img](imgs/e8fc3c93-2bfc-4b91-b214-8b7b61c2796b.jpg)

æ— ä¸€ä¾‹å¤–ï¼š

![image-20231031212737389](imgs/image-20231031212737389.png)

æ‰€ä»¥ï¼Œçº¢åŒ…é‡‘é¢ç®—æ³•å¤§æ¦‚ç‡ä¸æ˜¯éšæœºåˆ†é…ï¼Œè€Œæ˜¯åœ¨æ´¾å‘çº¢åŒ…ä¹‹å‰å·²ç»åšäº†å¤„ç†ã€‚æ¯”å¦‚åœ¨çº¢åŒ…é‡‘é¢ç”Ÿæˆå‰ï¼Œå…ˆç”Ÿæˆä¸€ä¸ªä¸å­˜åœ¨çš„çº¢åŒ…ï¼Œè¿™ä¸ªçº¢åŒ…çš„æ€»é¢ä¸º `0.01 * çº¢åŒ…æ€»æ•°`ã€‚

è€Œåœ¨çº¢åŒ…é‡‘é¢åˆ†é…çš„æ—¶å€™ï¼Œä¼šå¯¹æ¯ä¸ªçº¢åŒ…çš„éšæœºå€¼åŸºç¡€ä¸ŠåŠ ä¸Š `0.01`ï¼Œä»¥æ­¤æ¥ä¿è¯æ¯ä¸ªçº¢åŒ…çš„æœ€å°å€¼ä¸ä¸º 0ã€‚

å¹¶ä¸”ï¼Œå‡è®¾å½“ç”¨æˆ·å‘äº†æ€»é¢ä¸º 0.04 çš„ä¸ªæ•°ä¸º 3 çš„çº¢åŒ…æ—¶ï¼Œéœ€è¦å…ˆæå– `3*0.01` åˆ°æ–°çº¢åŒ…å»ï¼Œäºæ˜¯ç¬¬ä¸€ä¸ªäººæŠ¢åˆ°çš„çº¢åŒ…éšæœºå€¼æ˜¯ `0 ~ (0.04-3*0.01)/3`ã€‚

ç”±äºæ‹…å¿ƒçº¢åŒ…è¶…é¢ï¼Œæ‰€ä»¥é™¤æ•°çš„å•†æ˜¯å‘ä¸‹å–äºŒä½å°æ•°ï¼Œ`0 ~ (0.04-3*0.01)/3 ==> (0 ~ 0) = 0`ï¼Œå†åŠ ä¸Šä¹‹å‰æå–çš„ä¿åº•å€¼ `0.01`ï¼Œäºæ˜¯å‰ä¸¤ä¸ªæŠ¢åˆ°çš„çº¢åŒ…é‡‘é¢éƒ½æ˜¯ `0.01`ã€‚æœ€åä¸€ä¸ªçº¢åŒ…çš„é‡‘é¢ä¸ºçº¢åŒ…ä½™é¢ï¼Œå³ `0.02`ã€‚



ç®—æ³•é€»è¾‘ç”¨ Go è¯­è¨€å®ç°å¦‚ä¸‹ï¼š

``` go
import "math/rand"

type RedPack struct {
    SurplusAmount float64 // å‰©ä½™é‡‘é¢
    SurplusTotal int // çº¢åŒ…å‰©ä½™ä¸ªæ•°
}

func getRandomRedPack(rp RedPack) float64 {
    if rp.SurplusTotal == 1 {
        rp.SurplusTotal -= 1
        return rp.SurplusAmount
    }
    
    avgAmount := rp.SurplusAmount/float64(rp.SurplusTotal)
    rand.NewSource(time.Now().UnixNano()) // ç”Ÿæˆéšæœºæ•°ç§å­
    
    return rand.Float64()*(avgAmount*2-0.01) + 0.01
}

func main() {
    rp := RedPack{
        SurplusAmount: 0.04,
        SurplusTotal: 3,
    }
    rp.SurplusAmount -= 0.01 * rp.SurplusTotal
    num := rp.SurplusTotal
    for i:=0; i<num; i++ {
        fmt.Println(getRandomRedPack(rp))
    }
}
```

å¾®ä¿¡çš„ç¾¤å†…æŠ¢çº¢åŒ…åŠŸèƒ½èƒŒåè•´è—ç€å¤æ‚çš„æŠ€æœ¯å’Œç²¾å¿ƒè®¾è®¡çš„ç³»ç»Ÿï¼Œé€šè¿‡è¿™äº›æ ¸å¿ƒç»„ä»¶ã€æ•°æ®åº“è¡¨å’Œè¯¦ç»†çš„äº¤äº’æµç¨‹ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè½»æ¾å‚ä¸å¹¶äº«å—æŠ¢çº¢åŒ…çš„ä¹è¶£ã€‚è¿™ä¸ªåŠŸèƒ½çš„æˆåŠŸå®ç°æ˜¯æŠ€æœ¯ä¸åˆ›æ„çš„å®Œç¾èåˆï¼Œä¸ºå¾®ä¿¡ç¾¤çš„äº’åŠ¨å¢æ·»äº†è¶£å‘³å’Œæ´»åŠ›ã€‚



## 7. æ€»ç»“

å¾®ä¿¡å»ºç¾¤åŠŸèƒ½çš„ç³»ç»Ÿè®¾è®¡ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯å£®ä¸½çš„å±•ç¤ºï¼Œæ›´æ˜¯æ•°å­—ç¤¾äº¤çš„é­”æ³•ä¹‹ä¸€ã€‚é€šè¿‡é«˜å¹¶å‘ã€é«˜æ€§èƒ½çš„è®¾è®¡ï¼Œä»¥åŠå¯¹æµ·é‡æ•°æ®çš„å¤„ç†ï¼Œå¾®ä¿¡åˆ›é€ äº†ä¸€ä¸ªèƒ½è®©äººä»¬è”ç³»ã€åˆ†äº«å’Œäº’åŠ¨çš„æ•°å­—ç¤¾äº¤é­”æ³•ç©ºé—´ã€‚

å¦‚æœä½ æ›¾å¥½å¥‡è¿™äº›ç¤¾äº¤åº”ç”¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£äº†å¾®ä¿¡å»ºç¾¤åŠŸèƒ½çš„èƒŒåç³»ç»Ÿè®¾è®¡ã€‚æ•°å­—ç¤¾äº¤çš„ä¸–ç•Œæ— å¤„ä¸åœ¨ï¼Œè€Œå®ƒçš„é­”æ³•åˆ™æ˜¯æ·±æ€ç†Ÿè™‘çš„ç³»ç»Ÿè®¾è®¡ã€‚

å¸Œæœ›ä½ äº«å—äº†è¿™æ¬¡æ¢ç´¢ä¹‹æ—…ï¼Œä¸‹æ¬¡å†è§ï¼ ğŸš€



å‚è€ƒèµ„æ–™ï¼š

æ€è·¯ï¼šhttps://zhuanlan.zhihu.com/p/537702244

Redisè¯¦ç»†æ–¹æ¡ˆï¼ˆæ—¶åºå›¾ï¼‰ï¼šhttps://juejin.cn/post/6925947709517987848

ç®—æ³•è§£å¯†ï¼šhttp://www.52im.net/thread-3125-1-1.html

